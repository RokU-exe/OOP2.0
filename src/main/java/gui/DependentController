package gui;

import controllers.SystemAdmin;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Node;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.Alert;
import javafx.scene.control.Button;
import javafx.scene.control.TextField;
import javafx.stage.Stage;
import models.Customer;
import models.Dependent;
import models.LoginSession;
import models.User;
import utils.DBUtil;

import java.io.IOException;
import java.net.URL;
import java.util.ResourceBundle;

public class DependentController implements Initializable {
    @Override
    public void initialize(URL url, ResourceBundle resourceBundle) {
    }
    @FXML
    private TextField insuredPerson;

    Dependent dependent;
    public DependentController(Dependent dependent) {
        this.dependent = dependent;
    }
    public DependentController() {
        // Initialization code here, if needed
    }

    @FXML
    private Button dependentButton;
    public  Button getDependentButton() {
        return dependentButton;
    }

    @FXML
        //Open Dependent dashboard
    void openDependentDashboard(Button loginButton) {
        try {
            FXMLLoader loader = new FXMLLoader(getClass().getResource("/gui/DependentGUI/DependentCheckAgain.fxml"));
            Parent adminDashboardRoot = loader.load();
            Scene adminDashboardScene = new Scene(adminDashboardRoot);

            // Get any node from the current scene
            Node sourceNode = loginButton; // Use any node from the current scene

            // Get the primary stage from the source node's scene
            Stage primaryStage = (Stage) sourceNode.getScene().getWindow();

            primaryStage.setScene(adminDashboardScene);
            primaryStage.show();
        } catch (IOException e) {
            e.printStackTrace();
            // Handle any errors loading the admin dashboard FXML
        }
    }

//    @FXML
//    private Customer getProfile(){
//        User user  = new User();
//        LoginController loginController = new LoginController();
//        user = loginController.getUser();
//        Dependent d = new Dependent();
//        String profile = user.toString();
//        d = (Dependent) DBUtil.getFilteredCustomers(profile);
//        return d;
//    }
//    @FXML
//    private User getProfile() {
//        LoginController loginController = new LoginController();
//        User user = loginController.getUser();
//        return DBUtil.getUserByEmailAndPassword(user.getEmail(), user.getPassword());
//    }

    @FXML
//    public void getProfile() {
//        // Get the logged-in user
//        LoginController loginController = new LoginController();
////        User user = loginController.getUser();
//
//        // Fetch the profile information based on the user's email and password
////        User user1 = loginController.handleLogin();
//        User user1 = new User();
//        LoginSession loginSession = new LoginSession();
//        loginSession.getCurrentUser();
////        User userProfile = DBUtil.getUserByEmailAndPassword(user.getEmail(), user.getPassword());
//        DBUtil.getUserByEmailAndPassword(user1.getEmail(), user1.getPassword());
//        Alert alert = new Alert(Alert.AlertType.INFORMATION);
//
//        alert.setTitle("Add " + user1.getId());
//        alert.setHeaderText(user1.getEmail() + " Show Successfully!");
//        alert.setContentText(user1.toString());
//        alert.showAndWait();
//
//        if (user1 != null) {
//            // Depending on your GUI setup, you may want to pass the userProfile object to the profile view controller
//            // and display the profile information there
//            try {
//            FXMLLoader loader = new FXMLLoader(getClass().getResource("/gui/DependentGUI/DependentViewProfile.fxml"));
//            Parent adminDashboardRoot = loader.load();
//
//            Node sourceNode = dependentButton; // Use any node from the current scene
//
//            // Get the primary stage from the source node's scene
//            Stage primaryStage = (Stage) sourceNode.getScene().getWindow();
//
//            primaryStage.setScene(new Scene(adminDashboardRoot));
//            primaryStage.show();
//        } catch (IOException e) {
//            e.printStackTrace();
//            // Handle any errors loading the admin dashboard FXML
//        }
//        } else {
//            // Handle case where profile information could not be retrieved
//            // This could happen if there's an issue with the database query or if the user's credentials are incorrect
//            System.out.println("Error: Profile information not available.");
//        }
//    }

    public void getProfile() {
        // Get the current user from the session
        LoginSession loginSession = LoginSession.getInstance();
        User currentUser = loginSession.getCurrentUser();

        if (currentUser != null) {
            // Fetch the profile information based on the user's email and password
            User userProfile = DBUtil.getUserByEmailAndPassword(currentUser.getEmail(), currentUser.getPassword());

            if (userProfile != null) {
                // Display the profile information
                Alert alert = new Alert(Alert.AlertType.INFORMATION);
                alert.setTitle("Profile Information");
                alert.setHeaderText("Profile Retrieved Successfully");
                alert.setContentText(userProfile.toString());
                alert.showAndWait();

                // Depending on your GUI setup, you may want to pass the userProfile object to the profile view controller
                // and display the profile information there
                try {
                    FXMLLoader loader = new FXMLLoader(getClass().getResource("/gui/DependentGUI/DependentViewProfile.fxml"));
                    Parent adminDashboardRoot = loader.load();

                    // Get the primary stage from the current scene
                    Stage primaryStage = (Stage) dependentButton.getScene().getWindow();

                    primaryStage.setScene(new Scene(adminDashboardRoot));
                    primaryStage.show();
                } catch (IOException e) {
                    e.printStackTrace();
                    // Handle any errors loading the profile view FXML
                }
            } else {
                // Handle case where profile information could not be retrieved
                // This could happen if there's an issue with the database query
                System.out.println("Error: Profile information not available.");
            }
        } else {
            // Handle case where no user is logged in
            System.out.println("Error: No user logged in.");
        }
    }





//    @FXML
//    public void viewProfile(){
//        try {
//            FXMLLoader loader = new FXMLLoader(getClass().getResource("/gui/DependentGUI/DependentViewProfile.fxml"));
//            Parent adminDashboardRoot = loader.load();
//
//            Node sourceNode = dependentButton; // Use any node from the current scene
//
//            // Get the primary stage from the source node's scene
//            Stage primaryStage = (Stage) sourceNode.getScene().getWindow();
//
//            primaryStage.setScene(new Scene(adminDashboardRoot));
//            primaryStage.show();
//        } catch (IOException e) {
//            e.printStackTrace();
//            // Handle any errors loading the admin dashboard FXML
//        }
//    }
}
